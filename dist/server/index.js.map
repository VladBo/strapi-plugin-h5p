{"version":3,"file":"index.js","sources":["../../server/src/utils.ts","../../server/src/controllers/h5p.ts","../../server/src/controllers/index.ts","../../server/src/routes/index.ts","../../server/src/services/h5p.ts","../../server/src/services/index.ts","../../server/src/middlewares/h5p.ts","../../server/src/middlewares/index.ts","../../server/src/bootstrap.ts","../../server/src/register.ts","../../server/src/index.ts"],"sourcesContent":["import path from \"node:path\";\nimport fs from \"fs-extra\";\nimport type { H5PUser, H5PConfigState } from \"./types\";\n\nexport const getErrorMessage = (err: unknown): string =>\n  err instanceof Error ? err.message : \"Internal Server Error\";\n\nexport const resolveUser = (user?: H5PUser | null): H5PUser =>\n  user || {\n    id: \"anonymous\",\n    name: \"Anonymous\",\n    email: \"anonymous@example.com\",\n    type: \"local\",\n  };\n\nexport const getMimeType = (filePath: string): string => {\n  const ext = path.extname(filePath).toLowerCase();\n  switch (ext) {\n    case \".js\":\n      return \"application/javascript\";\n    case \".css\":\n      return \"text/css\";\n    case \".json\":\n      return \"application/json\";\n    case \".png\":\n      return \"image/png\";\n    case \".jpg\":\n    case \".jpeg\":\n      return \"image/jpeg\";\n    case \".gif\":\n      return \"image/gif\";\n    case \".svg\":\n      return \"image/svg+xml\";\n    case \".woff\":\n      return \"font/woff\";\n    case \".woff2\":\n      return \"font/woff2\";\n    case \".ttf\":\n      return \"font/ttf\";\n    case \".eot\":\n      return \"application/vnd.ms-fontobject\";\n    case \".otf\":\n      return \"font/otf\";\n    case \".mp4\":\n      return \"video/mp4\";\n    case \".webm\":\n      return \"video/webm\";\n    case \".ogg\":\n      return \"audio/ogg\";\n    case \".mp3\":\n      return \"audio/mpeg\";\n    case \".wav\":\n      return \"audio/wav\";\n    default:\n      return \"application/octet-stream\";\n  }\n};\n\nexport function safeJsonParse(value: unknown): unknown {\n  if (typeof value !== \"string\") {\n    return value;\n  }\n  try {\n    return JSON.parse(value);\n  } catch {\n    return value;\n  }\n}\n\nexport const buildLibrary = (input?: {\n  machineName?: string;\n  majorVersion?: number;\n  minorVersion?: number;\n}): string | undefined => {\n  if (!input?.machineName) return undefined;\n  if (\n    typeof input.majorVersion !== \"number\" ||\n    typeof input.minorVersion !== \"number\"\n  ) {\n    return undefined;\n  }\n  return `${input.machineName} ${input.majorVersion}.${input.minorVersion}`;\n};\n\nconst getString = (value: unknown): string | undefined =>\n  typeof value === \"string\" ? value : undefined;\n\nconst getLibraryFromObject = (value: unknown): string | undefined =>\n  buildLibrary(value as Parameters<typeof buildLibrary>[0]);\n\nconst getNestedLibrary = (value: unknown): string | undefined => {\n  if (!value || typeof value !== \"object\") {\n    return undefined;\n  }\n  const record = value as Record<string, unknown>;\n  return (\n    getString(record.library) ||\n    getString(record.mainLibrary) ||\n    getNestedLibrary(record.params)\n  );\n};\n\nexport const resolveLibrary = (\n  payload: Record<string, unknown> | undefined,\n): string | undefined => {\n  if (!payload) return undefined;\n  return (\n    getString(payload.library) ||\n    getString(payload.mainLibrary) ||\n    getLibraryFromObject(payload.library) ||\n    getLibraryFromObject(payload.mainLibrary) ||\n    getString(payload.ubername) ||\n    getString(payload.libraryName) ||\n    getNestedLibrary(safeJsonParse(payload.params))\n  );\n};\n\nexport const normalizeLibrary = (value?: string): string | undefined => {\n  if (!value) return value;\n  const match = /^([\\w.]+)-(\\d+\\.\\d+)$/.exec(value);\n  if (match) {\n    return `${match[1]} ${match[2]}`;\n  }\n  return value;\n};\n\nexport const createSlug = (title: string) =>\n  title\n    .toLowerCase()\n    .replaceAll(/[^a-z0-9]+/g, \"-\")\n    .replaceAll(/(^-|-$)/g, \"\");\n\nexport const getFileStreamResponse = (\n  filePath: string,\n): { stream: NodeJS.ReadableStream; mimeType: string } => {\n  if (!fs.existsSync(filePath)) {\n    throw new Error(`File not found: ${filePath}`);\n  }\n  const mimeType = getMimeType(filePath);\n  const stream = fs.createReadStream(filePath);\n  return { stream, mimeType };\n};\n\nexport const getMainLibraryVersion = (metadata: {\n  mainLibrary?: string;\n  preloadedDependencies?: any[];\n}) => {\n  if (!metadata?.mainLibrary) {\n    return undefined;\n  }\n  const dependency = metadata.preloadedDependencies?.find(\n    (d: any) => d.machineName === metadata.mainLibrary,\n  );\n  const major = dependency?.majorVersion ?? 1;\n  const minor = dependency?.minorVersion ?? 0;\n  return `${metadata.mainLibrary} ${major}.${minor}`;\n};\n\nexport const getConfigOrThrow = (state: {\n  h5pConfig: H5PConfigState | null;\n}) => {\n  if (!state.h5pConfig) {\n    throw new Error(\"H5P config not initialized\");\n  }\n  return state.h5pConfig;\n};\n","import { Core } from \"@strapi/strapi\";\nimport type { StrapiContext } from \"../types\";\nimport { getErrorMessage, createSlug } from \"../utils\";\n\nconst controller = ({ strapi }: { strapi: Core.Strapi }) => ({\n  async findContent(ctx: StrapiContext) {\n    try {\n      const contents = await strapi\n        .documents(\"api::h5p-content.h5p-content\")\n        .findMany({\n          ...ctx.query,\n        });\n      ctx.body = contents;\n    } catch (err) {\n      ctx.throw(500, getErrorMessage(err));\n    }\n  },\n  async findOneContent(ctx: StrapiContext) {\n    const { id } = ctx.params;\n    try {\n      const content = await strapi\n        .documents(\"api::h5p-content.h5p-content\")\n        .findOne({\n          documentId: id,\n          ...ctx.query,\n        });\n      ctx.body = content;\n    } catch (err) {\n      ctx.throw(500, getErrorMessage(err));\n    }\n  },\n  async createContent(ctx: StrapiContext) {\n    try {\n      const { title, library, parameters, metadata } = ctx.request\n        .body as Record<string, unknown>;\n      const slug = createSlug(title as string);\n      const embedCode = `<iframe src=\"${strapi.config.get(\n        \"server.url\",\n      )}/api/h5p/content/${slug}/embed\" width=\"100%\" height=\"600\" frameborder=\"0\" allowfullscreen></iframe>`;\n      const newContent = await strapi\n        .documents(\"api::h5p-content.h5p-content\")\n        .create({\n          data: {\n            title,\n            slug,\n            library,\n            parameters,\n            metadata,\n            embedCode,\n          },\n        });\n      ctx.body = newContent;\n    } catch (err) {\n      ctx.throw(500, getErrorMessage(err));\n    }\n  },\n  async updateContent(ctx: StrapiContext) {\n    const { id } = ctx.params;\n    try {\n      const updatedContent = await strapi\n        .documents(\"api::h5p-content.h5p-content\")\n        .update({\n          documentId: id,\n          data: ctx.request.body,\n        });\n      ctx.body = updatedContent;\n    } catch (err) {\n      ctx.throw(500, getErrorMessage(err));\n    }\n  },\n  async deleteContent(ctx: StrapiContext) {\n    const { id } = ctx.params;\n    try {\n      const deletedContent = await strapi\n        .documents(\"api::h5p-content.h5p-content\")\n        .delete({\n          documentId: id,\n        });\n      ctx.body = deletedContent;\n    } catch (err) {\n      ctx.throw(500, getErrorMessage(err));\n    }\n  },\n  async getLibraries(ctx: StrapiContext) {\n    try {\n      const h5pService = strapi.plugin(\"h5p\").service(\"service\");\n      const libraries = await h5pService.getInstalledLibraries();\n      ctx.body = libraries;\n    } catch (err) {\n      ctx.throw(500, getErrorMessage(err));\n    }\n  },\n  async getAvailableLibraries(ctx: StrapiContext) {\n    try {\n      const h5pService = strapi.plugin(\"h5p\").service(\"service\");\n      const libraries = await h5pService.getAvailableLibraries();\n      ctx.body = libraries;\n    } catch (err) {\n      ctx.throw(500, getErrorMessage(err));\n    }\n  },\n  async installLibrary(ctx: StrapiContext) {\n    try {\n      const h5pService = strapi.plugin(\"h5p\").service(\"service\");\n      const { id } = ctx.request.body as Record<string, unknown>;\n      const result = await h5pService.installLibrary(id);\n      ctx.body = result;\n    } catch (err) {\n      ctx.throw(500, getErrorMessage(err));\n    }\n  },\n  async getContentTypeCache(ctx: StrapiContext) {\n    try {\n      const h5pService = strapi.plugin(\"h5p\").service(\"service\");\n      const cache = await h5pService.getContentTypeCache();\n      ctx.body = cache;\n    } catch (err) {\n      ctx.throw(500, getErrorMessage(err));\n    }\n  },\n  async updateContentTypeCache(ctx: StrapiContext) {\n    try {\n      const h5pService = strapi.plugin(\"h5p\").service(\"service\");\n      const cache = await h5pService.updateContentTypeCache();\n      ctx.body = cache;\n    } catch (err) {\n      ctx.throw(500, getErrorMessage(err));\n    }\n  },\n  async getContentHubMetadataCache(ctx: StrapiContext) {\n    try {\n      const h5pService = strapi.plugin(\"h5p\").service(\"service\");\n      const cache = await h5pService.getContentHubMetadataCache();\n      ctx.body = cache;\n    } catch (err) {\n      ctx.throw(500, getErrorMessage(err));\n    }\n  },\n  async updateContentHubMetadataCache(ctx: StrapiContext) {\n    try {\n      const h5pService = strapi.plugin(\"h5p\").service(\"service\");\n      const cache = await h5pService.updateContentHubMetadataCache();\n      ctx.body = cache;\n    } catch (err) {\n      ctx.throw(500, getErrorMessage(err));\n    }\n  },\n  async getEditorModel(ctx: StrapiContext) {\n    try {\n      const h5pService = strapi.plugin(\"h5p\").service(\"service\");\n      const contentId =\n        ctx.params.contentId === \"new\" ? null : ctx.params.contentId;\n      const resolvedUser = ctx.state?.user;\n      const editorModel = await h5pService.getEditorModel(\n        contentId,\n        resolvedUser,\n      );\n      ctx.body = editorModel;\n    } catch (err) {\n      ctx.throw(500, getErrorMessage(err));\n    }\n  },\n  async getContentParams(ctx: StrapiContext) {\n    try {\n      const h5pService = strapi.plugin(\"h5p\").service(\"service\");\n      const params = await h5pService.getContentParams(ctx.params.contentId);\n      ctx.body = params;\n    } catch (err) {\n      ctx.throw(500, getErrorMessage(err));\n    }\n  },\n  async saveContent(ctx: StrapiContext) {\n    try {\n      const h5pService = strapi.plugin(\"h5p\").service(\"service\");\n      const result = await h5pService.saveContent(\n        ctx.request.body,\n        ctx.state?.user,\n      );\n      ctx.body = result;\n    } catch (err) {\n      ctx.throw(500, getErrorMessage(err));\n    }\n  },\n  async getLibraryFile(ctx: StrapiContext) {\n    try {\n      const h5pService = strapi.plugin(\"h5p\").service(\"service\");\n      const file = await h5pService.getLibraryFile(\n        ctx.params.ubername,\n        ctx.params.file,\n      );\n      ctx.type = file.mimeType;\n      ctx.body = file.stream;\n    } catch (err) {\n      ctx.throw(500, getErrorMessage(err));\n    }\n  },\n  async getContentFile(ctx: StrapiContext) {\n    try {\n      const h5pService = strapi.plugin(\"h5p\").service(\"service\");\n      const file = await h5pService.getContentFile(\n        ctx.params.contentId,\n        ctx.params.file,\n      );\n      ctx.type = file.mimeType;\n      ctx.body = file.stream;\n    } catch (err) {\n      ctx.throw(500, getErrorMessage(err));\n    }\n  },\n  async getCoreFile(ctx: StrapiContext) {\n    try {\n      const h5pService = strapi.plugin(\"h5p\").service(\"service\");\n      const file = await h5pService.getCoreFile(\n        ctx.params.type,\n        ctx.params.file,\n      );\n      ctx.type = file.mimeType;\n      ctx.body = file.stream;\n    } catch (err) {\n      ctx.throw(500, getErrorMessage(err));\n    }\n  },\n  async getEditorFile(ctx: StrapiContext) {\n    try {\n      const h5pService = strapi.plugin(\"h5p\").service(\"service\");\n      const file = await h5pService.getEditorFile(\n        ctx.params.type,\n        ctx.params.file,\n      );\n      ctx.type = file.mimeType;\n      ctx.body = file.stream;\n    } catch (err) {\n      ctx.throw(500, getErrorMessage(err));\n    }\n  },\n  async getPlayPage(ctx: StrapiContext) {\n    try {\n      const h5pService = strapi.plugin(\"h5p\").service(\"service\");\n      const html = await h5pService.renderPlayer(ctx.params.contentId);\n      ctx.type = \"text/html\";\n      ctx.body = html;\n    } catch (err) {\n      ctx.throw(500, getErrorMessage(err));\n    }\n  },\n  async getAjax(ctx: StrapiContext) {\n    try {\n      const h5pService = strapi.plugin(\"h5p\").service(\"service\");\n      const action =\n        ctx.query.action ||\n        (ctx.request.body &&\n          (ctx.request.body as Record<string, unknown>).action);\n      const result = await h5pService.handleAjax({\n        action,\n        query: ctx.query,\n        user: ctx.state?.user,\n        method: ctx.method,\n        body: ctx.request.body,\n        files: ctx.request.files,\n      });\n      if (result && result.body !== void 0) {\n        if (result.contentType) {\n          ctx.type = result.contentType;\n        }\n        if (result.status) {\n          ctx.status = result.status;\n        }\n        ctx.body = result.body;\n      } else {\n        ctx.body = result;\n      }\n    } catch (err) {\n      ctx.throw(500, getErrorMessage(err));\n    }\n  },\n});\n\nexport default controller;\n","import controller from \"./h5p\";\n\nexport default { controller };\n","const routes = {\n  \"content-api\": {\n    type: \"content-api\",\n    routes: [\n      {\n        method: \"GET\",\n        path: \"/contents\",\n        handler: \"controller.findContent\",\n        config: { auth: false },\n      },\n      {\n        method: \"GET\",\n        path: \"/contents/:id\",\n        handler: \"controller.findOneContent\",\n        config: { auth: false },\n      },\n      {\n        method: \"POST\",\n        path: \"/contents\",\n        handler: \"controller.createContent\",\n        config: { auth: false },\n      },\n      {\n        method: \"PUT\",\n        path: \"/contents/:id\",\n        handler: \"controller.updateContent\",\n        config: { auth: false },\n      },\n      {\n        method: \"DELETE\",\n        path: \"/contents/:id\",\n        handler: \"controller.deleteContent\",\n        config: { auth: false },\n      },\n      {\n        method: \"GET\",\n        path: \"/libraries\",\n        handler: \"controller.getLibraries\",\n        config: { auth: false },\n      },\n      {\n        method: \"GET\",\n        path: \"/libraries/available\",\n        handler: \"controller.getAvailableLibraries\",\n        config: { auth: false },\n      },\n      {\n        method: \"POST\",\n        path: \"/libraries/install\",\n        handler: \"controller.installLibrary\",\n        config: { auth: false },\n      },\n      {\n        method: \"GET\",\n        path: \"/ajax\",\n        handler: \"controller.getAjax\",\n        config: { auth: false },\n      },\n      {\n        method: \"POST\",\n        path: \"/ajax\",\n        handler: \"controller.getAjax\",\n        config: { auth: false },\n      },\n      {\n        method: \"GET\",\n        path: \"/params/:contentId\",\n        handler: \"controller.getContentParams\",\n        config: { auth: false },\n      },\n      {\n        method: \"POST\",\n        path: \"/save\",\n        handler: \"controller.saveContent\",\n        config: { auth: false },\n      },\n      {\n        method: \"GET\",\n        path: \"/libraries/:ubername/:file*\",\n        handler: \"controller.getLibraryFile\",\n        config: { auth: false },\n      },\n      {\n        method: \"GET\",\n        path: \"/content/:contentId/:file*\",\n        handler: \"controller.getContentFile\",\n        config: { auth: false },\n      },\n      {\n        method: \"GET\",\n        path: \"/editor-model/:contentId\",\n        handler: \"controller.getEditorModel\",\n        config: { auth: false },\n      },\n      {\n        method: \"GET\",\n        path: \"/core/:type/:file*\",\n        handler: \"controller.getCoreFile\",\n        config: { auth: false },\n      },\n      {\n        method: \"GET\",\n        path: \"/editor/:type/:file*\",\n        handler: \"controller.getEditorFile\",\n        config: { auth: false },\n      },\n      {\n        method: \"GET\",\n        path: \"/play/:contentId\",\n        handler: \"controller.getPlayPage\",\n        config: { auth: false },\n      },\n      {\n        method: \"GET\",\n        path: \"/content-type-cache\",\n        handler: \"controller.getContentTypeCache\",\n        config: { auth: false },\n      },\n      {\n        method: \"POST\",\n        path: \"/content-type-cache\",\n        handler: \"controller.updateContentTypeCache\",\n        config: { auth: false },\n      },\n      {\n        method: \"GET\",\n        path: \"/content-hub-metadata-cache\",\n        handler: \"controller.getContentHubMetadataCache\",\n        config: { auth: false },\n      },\n      {\n        method: \"POST\",\n        path: \"/content-hub-metadata-cache\",\n        handler: \"controller.updateContentHubMetadataCache\",\n        config: { auth: false },\n      },\n    ],\n  },\n};\n\nexport default routes;\n","import path from \"node:path\";\nimport fs from \"fs-extra\";\nimport * as h5pServer from \"@lumieducation/h5p-server\";\nimport type { H5PUser, H5PConfigState, HandleAjaxArgs } from \"../types\";\nimport {\n  resolveUser,\n  getMimeType,\n  safeJsonParse,\n  resolveLibrary,\n  normalizeLibrary,\n  getFileStreamResponse,\n  getMainLibraryVersion,\n} from \"../utils\";\nimport { Core } from \"@strapi/strapi\";\n\nconst service = ({ strapi }: { strapi: Core.Strapi }) => {\n  const state: {\n    h5pConfig: H5PConfigState | null;\n    h5pEditor: any | null;\n    h5pPlayer: any | null;\n  } = {\n    h5pConfig: null,\n    h5pEditor: null,\n    h5pPlayer: null,\n  };\n\n  const getConfig = (): H5PConfigState => {\n    if (!state.h5pConfig) {\n      throw new Error(\"H5P config not initialized\");\n    }\n    return state.h5pConfig;\n  };\n\n  const getEditor = (): any => {\n    if (!state.h5pEditor) {\n      throw new Error(\"H5P editor not initialized\");\n    }\n    return state.h5pEditor;\n  };\n\n  const getPlayer = (): any => {\n    if (!state.h5pPlayer) {\n      throw new Error(\"H5P player not initialized\");\n    }\n    return state.h5pPlayer;\n  };\n\n  return {\n    async initialize(): Promise<void> {\n      strapi.log.info(\"Initializing H5P Editor and Player...\");\n      const config2 = strapi.config.get(\"plugin.h5p\") || {};\n      const pluginConfig = config2.config || {};\n      const baseUrl = \"/api/h5p\";\n      const h5pConfig = new h5pServer.H5PConfig(void 0, {\n        baseUrl,\n        contentHubEnabled: true,\n      });\n      const libraryPath = path.join(\n        strapi.dirs.static.public,\n        pluginConfig.librariesPath || \"h5p/libraries\",\n      );\n      const contentPath = path.join(\n        strapi.dirs.static.public,\n        pluginConfig.contentPath || \"h5p/content\",\n      );\n      const temporaryPath = path.join(\n        strapi.dirs.static.public,\n        pluginConfig.temporaryFilesPath || \"h5p/temp-files\",\n      );\n      state.h5pConfig = {\n        baseUrl,\n        editorUrl: `${baseUrl}${h5pConfig.editorLibraryUrl}`,\n        coreUrl: `${baseUrl}${h5pConfig.coreUrl}`,\n        contentTypeCacheUrl: `${baseUrl}/ajax?action=content-type-cache`,\n        contentHubMetadataUrl: `${baseUrl}/ajax?action=content-hub-metadata-cache`,\n        contentStorage: {\n          libraryPath,\n          contentPath,\n          temporaryPath,\n        },\n      };\n      await fs.ensureDir(libraryPath);\n      await fs.ensureDir(contentPath);\n      await fs.ensureDir(temporaryPath);\n      const cache = new h5pServer.fsImplementations.InMemoryStorage();\n      const libraryStorage = new h5pServer.fsImplementations.FileLibraryStorage(\n        libraryPath,\n      );\n      const contentStorage = new h5pServer.fsImplementations.FileContentStorage(\n        contentPath,\n      );\n      const temporaryStorage =\n        new h5pServer.fsImplementations.DirectoryTemporaryFileStorage(\n          temporaryPath,\n        );\n      state.h5pEditor = new h5pServer.H5PEditor(\n        cache,\n        h5pConfig,\n        libraryStorage,\n        contentStorage,\n        temporaryStorage,\n      );\n      state.h5pPlayer = new h5pServer.H5PPlayer(\n        libraryStorage,\n        contentStorage,\n        h5pConfig,\n      );\n      strapi.log.info(\"H5P Editor and Player initialized successfully\");\n    },\n    async getInstalledLibraries(): Promise<any> {\n      try {\n        const libraries =\n          await getEditor().libraryManager.listInstalledLibraries();\n        return libraries;\n      } catch (error) {\n        strapi.log.error(\"Failed to get installed libraries:\", error);\n        throw error;\n      }\n    },\n    async getAvailableLibraries(): Promise<any> {\n      try {\n        const libraries = await getEditor().contentHub.getLibraries();\n        return libraries;\n      } catch (error) {\n        strapi.log.error(\"Failed to get available libraries:\", error);\n        throw error;\n      }\n    },\n    async installLibrary(libraryId: string): Promise<any> {\n      try {\n        const result = await getEditor().contentHub.installLibrary(libraryId);\n        return { success: true, result };\n      } catch (error) {\n        strapi.log.error(\"Failed to install library:\", error);\n        throw error;\n      }\n    },\n    async getContentTypeCache(): Promise<any> {\n      try {\n        const cache = await getEditor().contentTypeCache.get();\n        return cache;\n      } catch (error) {\n        strapi.log.error(\"Failed to get content type cache:\", error);\n        throw error;\n      }\n    },\n    async updateContentTypeCache(): Promise<any> {\n      try {\n        const cache = await getEditor().contentTypeCache.update();\n        return cache;\n      } catch (error) {\n        strapi.log.error(\"Failed to update content type cache:\", error);\n        throw error;\n      }\n    },\n    async getContentHubMetadataCache(): Promise<any> {\n      try {\n        const cache = await getEditor().contentHubMetadataCache.get();\n        return cache;\n      } catch (error) {\n        strapi.log.error(\"Failed to get content hub metadata cache:\", error);\n        throw error;\n      }\n    },\n    async updateContentHubMetadataCache(): Promise<any> {\n      try {\n        const cache = await getEditor().contentHubMetadataCache.update();\n        return cache;\n      } catch (error) {\n        strapi.log.error(\"Failed to update content hub metadata cache:\", error);\n        throw error;\n      }\n    },\n    async handleAjax({\n      action,\n      query,\n      user,\n      method,\n      body,\n      files,\n    }: HandleAjaxArgs): Promise<any> {\n      try {\n        const actionValue = Array.isArray(action) ? action[0] : action || \"\";\n        const resolvedUsr = resolveUser(user ?? undefined);\n        const ajaxEndpoint = new h5pServer.H5PAjaxEndpoint(getEditor());\n        const language = (query as Record<string, unknown> | undefined)\n          ?.language as string | undefined;\n        const resolvedMethod = (method || \"GET\").toUpperCase();\n        const postActions = new Set([\n          \"translations\",\n          \"files\",\n          \"filter\",\n          \"library-install\",\n          \"library-upload\",\n          \"get-content\",\n        ]);\n        const shouldPost =\n          resolvedMethod === \"POST\" || postActions.has(actionValue);\n        if (shouldPost) {\n          const id = (query as Record<string, unknown> | undefined)?.id as\n            | string\n            | undefined;\n          const hubId = (query as Record<string, unknown> | undefined)\n            ?.hubId as string | undefined;\n          const translate = (\n            stringId: string,\n            replacements: { [key: string]: any },\n          ) => {\n            if (!replacements) {\n              return stringId;\n            }\n            return Object.keys(replacements).reduce(\n              (text, key) =>\n                text.split(`:${key}`).join(String(replacements[key])),\n              stringId,\n            );\n          };\n          const normalizeFile = (file: any) => {\n            if (!file) {\n              return undefined;\n            }\n            const actual = Array.isArray(file) ? file[0] : file;\n            if (!actual) {\n              return undefined;\n            }\n            return {\n              data: actual.buffer,\n              mimetype: actual.type || actual.mimetype,\n              name: actual.name || actual.originalFilename || actual.filename,\n              size: actual.size,\n              tempFilePath:\n                actual.path || actual.filepath || actual.tempFilePath,\n            };\n          };\n          const filesObj = files as Record<string, unknown> | undefined;\n          const filesFile = normalizeFile(filesObj?.file);\n          const libraryUploadFile = normalizeFile(filesObj?.h5p);\n          const resolvedBody = body as\n            | { libraries: string[] }\n            | { contentId: string; field: string }\n            | { libraryParameters: string }\n            | undefined;\n          return await ajaxEndpoint.postAjax(\n            actionValue,\n            resolvedBody,\n            language,\n            resolvedUsr,\n            filesFile,\n            id,\n            translate,\n            libraryUploadFile,\n            hubId,\n          );\n        }\n        const queryObj = query as Record<string, unknown> | undefined;\n        return await ajaxEndpoint.getAjax(\n          actionValue,\n          queryObj?.machineName as string | undefined,\n          queryObj?.majorVersion as string | undefined,\n          queryObj?.minorVersion as string | undefined,\n          language,\n          resolvedUsr,\n        );\n      } catch (error) {\n        strapi.log.error(\"Failed to handle H5P AJAX request:\", error);\n        throw error;\n      }\n    },\n    async getContentParams(contentId: string): Promise<any> {\n      try {\n        const contentStorage = getEditor().contentStorage;\n        const [metadata, parameters] = await Promise.all([\n          contentStorage.getMetadata(contentId),\n          contentStorage.getParameters(contentId),\n        ]);\n        return {\n          library: getMainLibraryVersion(metadata),\n          params: parameters,\n          metadata: {\n            title: metadata.title,\n            license: metadata.license,\n          },\n        };\n      } catch (error) {\n        strapi.log.error(\n          `Failed to get content params for ${contentId}:`,\n          error,\n        );\n        throw error;\n      }\n    },\n    async saveContent(\n      contentData: {\n        library?:\n          | string\n          | {\n              machineName?: string;\n              majorVersion?: number;\n              minorVersion?: number;\n            };\n        mainLibrary?:\n          | string\n          | {\n              machineName?: string;\n              majorVersion?: number;\n              minorVersion?: number;\n            };\n        params?: any;\n        metadata?: any;\n        [key: string]: any;\n      },\n      user?: H5PUser | null,\n    ): Promise<{ id: any }> {\n      try {\n        const parsedContentData =\n          typeof contentData === \"string\"\n            ? safeJsonParse(contentData)\n            : contentData;\n        const payload =\n          parsedContentData &&\n          typeof parsedContentData === \"object\" &&\n          \"data\" in (parsedContentData as Record<string, unknown>)\n            ? (parsedContentData as any).data\n            : parsedContentData;\n\n        const library = normalizeLibrary(\n          resolveLibrary(payload as Record<string, unknown>),\n        );\n        if (!library) {\n          strapi.log.error(\"Failed to save content: missing library\", {\n            keys: Object.keys(contentData || {}),\n          });\n          throw new Error(\"missing-library\");\n        }\n\n        const parsedParams = safeJsonParse(payload?.params);\n        const parsedMetadata = safeJsonParse(payload?.metadata);\n        const paramsContainer = (parsedParams as Record<string, unknown>)\n          ?.params\n          ? parsedParams\n          : undefined;\n\n        const params =\n          (paramsContainer as Record<string, unknown>)?.params ?? parsedParams;\n        const rawMetadata =\n          parsedMetadata ??\n          (paramsContainer as Record<string, unknown>)?.metadata;\n        const fallbackTitle =\n          (rawMetadata as Record<string, unknown>)?.title ??\n          (\n            (paramsContainer as Record<string, unknown>)?.metadata as\n              | Record<string, unknown>\n              | undefined\n          )?.title ??\n          (\n            (parsedParams as Record<string, unknown>)?.metadata as\n              | Record<string, unknown>\n              | undefined\n          )?.title ??\n          (parsedParams as Record<string, unknown>)?.title ??\n          payload?.title ??\n          \"Untitled\";\n        const metadata: Record<string, any> = {\n          title: fallbackTitle,\n        };\n\n        if (\n          typeof (rawMetadata as Record<string, unknown>)?.language === \"string\"\n        ) {\n          if (\n            /^[-a-zA-Z]{1,10}$/.test(\n              (rawMetadata as Record<string, string>).language,\n            )\n          ) {\n            metadata.language = (\n              rawMetadata as Record<string, string>\n            ).language;\n          }\n        }\n        const resolvedUsr = resolveUser(user ?? undefined);\n        const contentId = await getEditor().saveOrUpdateContent(\n          payload?.contentId ?? undefined,\n          params,\n          metadata,\n          library,\n          resolvedUsr,\n        );\n        return { id: contentId };\n      } catch (error) {\n        strapi.log.error(\"Failed to save content:\", error);\n        throw error;\n      }\n    },\n    async getLibraryFile(\n      ubername: string,\n      file: string,\n    ): Promise<{ stream: NodeJS.ReadableStream; mimeType: string }> {\n      try {\n        const h5pConfig = getConfig();\n        const filePath = path.join(\n          h5pConfig.contentStorage.libraryPath,\n          ubername,\n          file,\n        );\n        return getFileStreamResponse(filePath);\n      } catch (error) {\n        strapi.log.error(\"Failed to get library file:\", error);\n        throw error;\n      }\n    },\n    async getContentFile(\n      contentId: string,\n      file: string,\n    ): Promise<{ stream: NodeJS.ReadableStream; mimeType: string }> {\n      try {\n        const h5pConfig = getConfig();\n        let resolvedFile = file;\n        if (file === \"content/content.json\") {\n          resolvedFile = \"content.json\";\n        } else if (file.startsWith(\"content/\")) {\n          resolvedFile = file.replace(/^content\\//, \"\");\n        }\n        const filePath = path.join(\n          h5pConfig.contentStorage.contentPath,\n          contentId,\n          resolvedFile,\n        );\n        return getFileStreamResponse(filePath);\n      } catch (error) {\n        strapi.log.error(\"Failed to get content file:\", error);\n        throw error;\n      }\n    },\n    async getCoreFile(\n      type: string,\n      file: string,\n    ): Promise<{ stream: NodeJS.ReadableStream; mimeType: string }> {\n      try {\n        const h5pConfig = getConfig();\n        const filePath = path.join(\n          h5pConfig.contentStorage.libraryPath,\n          \"core\",\n          type,\n          file,\n        );\n        return getFileStreamResponse(filePath);\n      } catch (error) {\n        strapi.log.error(\"Failed to get core file:\", error);\n        throw error;\n      }\n    },\n    async getEditorFile(\n      type: string,\n      file: string,\n    ): Promise<{ stream: NodeJS.ReadableStream; mimeType: string }> {\n      try {\n        const h5pConfig = getConfig();\n        const filePath = path.join(\n          h5pConfig.contentStorage.libraryPath,\n          \"editor\",\n          type,\n          file,\n        );\n        return getFileStreamResponse(filePath);\n      } catch (error) {\n        strapi.log.error(\"Failed to get editor file:\", error);\n        throw error;\n      }\n    },\n    async renderPlayer(contentId: string): Promise<any> {\n      try {\n        return await getPlayer().render(contentId);\n      } catch (error) {\n        strapi.log.error(\n          `Failed to render H5P player for ${contentId}:`,\n          error,\n        );\n        throw error;\n      }\n    },\n    async getEditorModel(\n      contentId: string | null,\n      user?: H5PUser | null,\n    ): Promise<any> {\n      try {\n        const resolvedUsr = resolveUser(user ?? undefined);\n        const originalRenderer = getEditor().setRenderer((model: any) => model);\n        try {\n          const editorModel = await getEditor().render(\n            contentId,\n            \"en\",\n            resolvedUsr,\n          );\n          return editorModel;\n        } finally {\n          getEditor().setRenderer(originalRenderer);\n        }\n      } catch (error) {\n        strapi.log.error(\"Failed to get editor model:\", error);\n        throw error;\n      }\n    },\n    async readFile(filePath: string): Promise<Buffer> {\n      try {\n        return await fs.readFile(filePath);\n      } catch (error) {\n        strapi.log.error(`Failed to read file ${filePath}:`, error);\n        throw error;\n      }\n    },\n    getMimeType,\n  };\n};\n\nexport default service;\n","import service from \"./h5p\";\n\nexport default { service };\n","import path from \"node:path\";\nimport fs from \"fs-extra\";\n\nconst MIME_TYPES: Record<string, string> = {\n  \".css\": \"text/css\",\n  \".js\": \"application/javascript\",\n  \".json\": \"application/json\",\n  \".svg\": \"image/svg+xml\",\n  \".png\": \"image/png\",\n  \".jpg\": \"image/jpeg\",\n  \".jpeg\": \"image/jpeg\",\n  \".gif\": \"image/gif\",\n  \".woff\": \"font/woff\",\n  \".woff2\": \"font/woff2\",\n  \".ttf\": \"font/ttf\",\n  \".eot\": \"application/vnd.ms-fontobject\",\n  \".html\": \"text/html\",\n};\n\nfunction containsPathTraversal(filePath: string): boolean {\n  const normalized = path.normalize(filePath);\n  return normalized.includes(\"..\") || filePath.includes(\"..\");\n}\n\nexport default (\n  config: unknown,\n  {\n    strapi,\n  }: {\n    strapi: Record<string, unknown> & {\n      dirs: { static: { public: string } };\n      log: { error: (...args: unknown[]) => void };\n    };\n  },\n) => {\n  return async (\n    ctx: { request: { url: string }; type: string; body: unknown },\n    next: () => Promise<void>,\n  ) => {\n    const { url } = ctx.request;\n\n    // Handle H5P core assets\n    if (url.startsWith(\"/api/h5p/core/\")) {\n      const filePath = url.replace(\"/api/h5p/core/\", \"\").split(\"?\")[0];\n\n      if (containsPathTraversal(filePath)) {\n        ctx.body = \"Forbidden\";\n        return;\n      }\n\n      const fullPath = path.join(\n        strapi.dirs.static.public,\n        \"uploads/h5p/core\",\n        filePath,\n      );\n\n      try {\n        if (await fs.pathExists(fullPath)) {\n          const ext = path.extname(fullPath);\n          ctx.type = MIME_TYPES[ext] || \"application/octet-stream\";\n\n          // Special handling for jQuery - modify it to force browser mode\n          if (filePath === \"js/jquery.js\") {\n            const originalContent = await fs.readFile(fullPath, \"utf-8\");\n            const modifiedContent = originalContent.replace(\n              '\"object\"==typeof module&&\"object\"==typeof module.exports?',\n              \"false&&false?\",\n            );\n            ctx.body = modifiedContent;\n            return;\n          }\n\n          // Special handling for h5p.js - ensure H5P.jQuery is set before it runs\n          if (filePath === \"js/h5p.js\") {\n            const originalContent = await fs.readFile(fullPath, \"utf-8\");\n            ctx.body = `\n// Ensure H5P.jQuery is set before h5p.js runs\n(function() {\n  var jq = window.jQuery || window.$ || (typeof jQuery !== 'undefined' ? jQuery : null);\n  if (typeof jq === 'function') {\n    window.H5P = window.H5P || {};\n    window.H5P.jQuery = jq;\n    window.H5PEditor = window.H5PEditor || {};\n    window.H5PEditor.$ = jq;\n  }\n})();\n\n${originalContent}\n`;\n            return;\n          }\n\n          ctx.body = await fs.readFile(fullPath);\n          return;\n        }\n      } catch (error) {\n        strapi.log.error(\"[h5p-static] Failed to read core file:\", error);\n      }\n    }\n\n    // Handle H5P editor assets\n    if (url.startsWith(\"/api/h5p/editor/\")) {\n      const filePath = url.replace(\"/api/h5p/editor/\", \"\").split(\"?\")[0];\n\n      if (containsPathTraversal(filePath)) {\n        ctx.body = \"Forbidden\";\n        return;\n      }\n\n      const fullPath = path.join(\n        strapi.dirs.static.public,\n        \"uploads/h5p/editor\",\n        filePath,\n      );\n\n      try {\n        if (await fs.pathExists(fullPath)) {\n          const ext = path.extname(fullPath);\n          ctx.type = MIME_TYPES[ext] || \"application/octet-stream\";\n\n          // Special handling for language files\n          if (filePath.startsWith(\"language/\") && filePath.endsWith(\".js\")) {\n            const originalContent = await fs.readFile(fullPath, \"utf-8\");\n            ctx.body = `\n// Ensure H5PEditor.language exists before setting language.core\n(function() {\n  window.H5PEditor = window.H5PEditor || {};\n  window.H5PEditor.language = window.H5PEditor.language || {};\n})();\n\n${originalContent}\n`;\n            return;\n          }\n\n          ctx.body = await fs.readFile(fullPath);\n          return;\n        }\n      } catch (error) {\n        strapi.log.error(\"[h5p-static] Failed to read editor file:\", error);\n      }\n    }\n\n    // Handle H5P libraries\n    if (url.startsWith(\"/api/h5p/libraries/\")) {\n      const filePath = url.replace(\"/api/h5p/libraries/\", \"\").split(\"?\")[0];\n\n      if (containsPathTraversal(filePath)) {\n        ctx.body = \"Forbidden\";\n        return;\n      }\n\n      const fullPath = path.join(\n        strapi.dirs.static.public,\n        \"uploads/h5p/libraries\",\n        filePath,\n      );\n\n      try {\n        if (await fs.pathExists(fullPath)) {\n          const ext = path.extname(fullPath);\n          ctx.type = MIME_TYPES[ext] || \"application/octet-stream\";\n          ctx.body = await fs.readFile(fullPath);\n          return;\n        }\n      } catch (error) {\n        strapi.log.error(\"[h5p-static] Failed to read library file:\", error);\n      }\n    }\n\n    await next();\n  };\n};\n","import middleware from \"./h5p\";\n\nexport default {\n  h5p: middleware,\n};\n","import type { Core } from \"@strapi/strapi\";\n\nconst bootstrap = async ({ strapi }: { strapi: Core.Strapi }) => {\n  const h5pService = strapi.plugin(\"h5p\").service(\"service\");\n  await h5pService.initialize();\n};\n\nexport default bootstrap;\n","import type { Core } from \"@strapi/strapi\";\n\nconst register = ({ strapi }: { strapi: Core.Strapi }) => {\n  strapi.customFields.register({\n    name: \"h5p-editor\",\n    plugin: \"h5p\",\n    type: \"json\",\n  });\n};\n\nexport default register;\n","import controllers from \"./controllers\";\nimport routes from \"./routes\";\nimport services from \"./services\";\nimport middlewares from \"./middlewares\";\nimport bootstrap from \"./bootstrap\";\nimport register from \"./register\";\n\nconst config = {\n  default: {},\n  validator() {},\n};\n\nconst index = {\n  register,\n  bootstrap,\n  config,\n  controllers,\n  routes,\n  services,\n  middlewares,\n};\nexport default index;\n"],"names":["path","fs","h5pServer","config"],"mappings":"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"}